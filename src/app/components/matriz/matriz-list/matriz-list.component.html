<div class="tela d-flex flex-column col-lg-12 w-100 p-2">
  <div class="d-flex align-items-center justify-content-between">
    <div class="d-flex align-items-center">
      <button type="button" class="botao_voltar me-2" routerLink="/home">
        <i class="bi bi-arrow-left"></i>
      </button>

      <h2 class="titulo m-0">Matrizes</h2>
    </div>

    <div class="d-flex justify-content-between my-2 gap-2 area-btns">
      @if (usuario && usuario.permissao && usuario.permissao.cadastrarMatriz) {
      <div>
        <button
          type="button"
          (click)="cadastrarMatriz(modalMatriz)"
          class="btn-comum btn-comum-laranja"
        >
          Novo Matriz
        </button>
      </div>
      } @if (usuario && usuario.permissao && usuario.permissao.permissao) {
      <div>
        <button
          type="button"
          (click)="abrirModalPermissaosList(modalListaPermissaos)"
          class="btn-comum btn-comum-laranja"
        >
          Permissaos
        </button>
      </div>
      }
    </div>
  </div>

  <div
    class="col-lg-12 d-flex align-items-center gap-3 pb-2 w-100 area-pesquisa"
  >
    <div class="d-flex flex-column w-100">
      <label for="nome">Nome</label>
      <div class="filtro-pesquisa">
        <input
          id="nome"
          class="form-control"
          type="text"
          placeholder="nome"
          [(ngModel)]="nome"
          (keydown.enter)="filtrarMatrizes()"
        />
        <button type="button" class="botao_cep" (click)="filtrarMatrizes()">
          <img src="../../../../assets/images/search.svg" class="busca" />
        </button>
      </div>
    </div>
    <div class="d-flex align-items-center gap-2 w-25 tamanho-select">
      <div class="d-flex flex-column w-100">
        <label>Ativo</label>
        <select
          class="select-filtro p-1"
          [(ngModel)]="ativo"
          (change)="filtrarMatrizes()"
        >
          <option value="">Todos</option>
          <option value="true">Sim</option>
          <option value="false">Não</option>
        </select>
      </div>
    </div>
  </div>

  <div class="lista">
    <table class="table">
      <thead>
        <th class="text-center col-1">#</th>
        <th class="text-center col-1">Nome</th>
        <th class="text-center col-1">Funcionários</th>
        <th class="text-center col-1">Permissão</th>
        <th class="text-center col-2">Ações</th>
      </thead>
      <tbody>
        @for (matriz of listaMatrizesFiltrada; track $index) {
        <tr>
          <td class="text-center">{{ $index }}</td>
          <td class="text-center">{{ matriz?.nome }}</td>
          <td class="text-center">{{ matriz?.limiteFuncionarios }}</td>
          <td class="text-center">{{ matriz?.permissao?.nome }}</td>
          <td>
            <div class="col-acoes">
              @if (usuario && usuario.permissao && usuario.permissao.editarMatriz) {
                <button
                  type="button"
                  (click)="editarMatriz(modalMatriz, matriz, $index)"
                  class="hover-btn"
                  name="Editar{{ $index }}"
                >
                  <img
                    src="../../../../assets/images/botao_editar.svg"
                    alt="Editar"
                  />
                  <span class="hover-text">Editar</span>
                </button>
              }
              @if (usuario && usuario.permissao && usuario.permissao.editarMatriz) {
                <button
                  type="button"
                  (click)="ativarOuDesativarMatriz(matriz)"
                  class="hover-btn"
                  name="Desativar{{ $index }}"
                >
                  @if (matriz.ativo == true) {
                  <img
                    src="../../../../assets/images/pause.svg"
                    alt="Desativar"
                    class="icon-tamanho"
                  />
                  <span class="hover-text">Desativar</span>
                  } @if (matriz.ativo == false) {
                  <img
                    src="../../../../assets/images/play.svg"
                    alt="Desativar"
                    class="icon-tamanho"
                  />
                  <span class="hover-text">Ativar</span>
                  }
                </button>
              }
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
</div>

<ng-template #modalMatriz let-modal>
  <div class="modal-header modal-style">
    <h4 class="modal-title">{{ tituloModal }}</h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body modal-style">
    <app-matriz-detalhes
      #matrizDetalhes
      [matriz]="matriz"
      (retorno)="atualizarListaMatriz($event)"
    ></app-matriz-detalhes>
  </div>
  <div
    class="modal-footer d-flex justify-content-center align-items-center border-0"
  >
    <button
      type="button"
      class="btn-comum btn-comum-laranja"
      (click)="matrizDetalhes.salvar()"
    >
      Salvar
    </button>
  </div>
</ng-template>

<ng-template #modalListaPermissaos let-modal>
  <div class="modal-header modal-style">
    <h4 class="modal-title">{{ tituloModal }}</h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body modal-style">
    <app-permissao-lista></app-permissao-lista>
  </div>
</ng-template>
